#!/usr/bin/env bash

# Check DREAMSDK_BASE environment variable
if [ -z "${DREAMSDK_BASE}" ]; then
  echo "fatal: \$DREAMSDK_BASE is undefined!" >&2
  exit 1
fi

# Convert parameter to lowercase
param=$(echo "$1" | awk '{print tolower($0)}')

# Validate parameter
if [ -z "${param}" ]; then
  echo "fatal: no supplied parameter, must be --release, --build or --date." >&2
  exit 2
fi

case "${param}" in
  "--release"|"--build"|"--date")
    # Valid parameter
    ;;
  *)
    echo "fatal: invalid option: ${param}" >&2
    exit 3
    ;;
esac

# Version file path
dreamsdk_version_file="${DREAMSDK_BASE}/VERSION"

# Check if VERSION file exists
if [ ! -f "${dreamsdk_version_file}" ]; then
  echo "fatal: VERSION file not found: ${dreamsdk_version_file}" >&2
  exit 4
fi

# Process according to parameter
case "${param}" in
  "--release")
    awk -F "=" '/Release/ {print $2}' "${dreamsdk_version_file}"
    ;;
  "--build")
    awk -F "=" '/BuildNumber/ {print $2}' "${dreamsdk_version_file}"
    ;;
  "--date")
    awk -F "=" '/Date/ {print $2}' "${dreamsdk_version_file}"
    ;;
esac
